<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>児童館 物品貸出管理</title>

    <style>
      body {
        margin: 0;
        font-family: sans-serif;
      }

      .screen {
        display: none;
        height: 100vh;
        width: 100vw;
        justify-content: center;
        align-items: center;
        flex-direction: column;
      }

      .screen.active {
        display: flex;
      }

      h1 {
        margin: 30px;
      }

      p {
        margin-top: 50px;
      }

      button {
        font-size: 20px;
        padding: 20px 40px;
        margin: 10px;
        border-radius: 10px;
        border: 0 solid #000;
        cursor: pointer;
      }

      button.disabled {
        background: #ccc;
        color: #888;
        pointer-events: none;
      }

      button.selected {
        background-color: #8fd18f;
      }

      .menu {
        display: flex;
        gap: 40px;
      }

      .menu-btn {
        width: 260px;
        height: 260px;
        position: relative;
        font-size: 24px;
        font-weight: bold;
        background-size: cover;
        background-position: center;
      }

      .menu-btn::after {
        content: "";
        position: absolute;
        inset: 0;
        background: rgba(255, 255, 255, 0.5);
        border-radius: 10px;
      }

      .menu-btn span {
        position: relative;
        z-index: 1;
      }

      .tabletennis { background-image: url("tabletennis.png"); }
      .controller { background-image: url("controller.png"); }
      .boardgame { background-image: url("boardgame.png"); }
      .charger { background-image: url("charger.png"); }

      .select-area {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        max-width: 600px;
      }

      input {
        font-size: 22px;
        padding: 10px;
        margin: 10px;
        width: 300px;
      }

      input:focus, input:hover {
        outline: none;
        box-shadow: none;
      }

      .back {
        position: fixed;
        left: 30px;
        bottom: 30px;
      }

      table {
        width: 90%;
        border-collapse: collapse;
      }

      th, td {
        border: 1px solid #000;
        padding: 10px;
      }

      th {
        background: #000;
        color: #fff;
      }
    </style>
  </head>

  <body>
    <!-- 画面1 -->
    <div class="screen active" id="screen1">
      <h1>貸出物品選択</h1>
      <div class="menu">
        <button class="menu-btn tabletennis" onclick="selectItem('卓球ラケット')"><span>卓球ラケット</span></button>
        <button class="menu-btn controller" onclick="selectItem('コントローラー')"><span>コントローラー</span></button>
        <button class="menu-btn boardgame" onclick="selectItem('ボドゲ・その他')"><span>ボドゲ・その他</span></button>
        <button class="menu-btn charger" onclick="selectItem('充電器類')"><span>充電器類</span></button>
      </div>
      <button onclick="showScreen(6)">返却確認</button>
    </div>

    <!-- 画面2：卓球ラケット -->
    <div class="screen" id="screen2">
      <h1>卓球ラケット</h1>
      <p>複数選択できます</p>
      <div class="select-area" id="racketArea"></div>
      <p>登録番号を入力し、借りるボタンを押してください</p>
      <input type="number" id="regNumber2" placeholder="登録番号" />
      <button onclick="borrow()">借りる</button>
      <button class="back" onclick="showScreen(1)">戻る</button>
    </div>

    <!-- 画面3：コントローラー -->
    <div class="screen" id="screen3">
      <h1>コントローラー</h1>
      <p>1つ選択してください</p>
      <div class="select-area" id="controllerArea"></div>
      <p>登録番号を入力し、借りるボタンを押してください</p>
      <input type="number" id="regNumber3" placeholder="登録番号" />
      <button onclick="borrow()">借りる</button>
      <button class="back" onclick="showScreen(1)">戻る</button>
    </div>

    <!-- 画面4：ボドゲ・その他 -->
    <div class="screen" id="screen4">
      <h1>ボドゲ・その他</h1>
      <p>ボードゲームの種類を選んでください</p>
      <input list="games" id="gameInput" placeholder="選択してください" />
      <datalist id="games">
        <option value="トランプ"></option>
        <option value="UNO"></option>
        <option value="ジェンガ"></option>
        <option value="dobble"></option>
        <option value="将棋"></option>
        <option value="オセロ"></option>
      </datalist>
      <p>登録番号を入力し、借りるボタンを押してください</p>
      <input type="number" id="regNumber4" placeholder="登録番号" />
      <button onclick="borrowGame()">借りる</button>
      <button class="back" onclick="showScreen(1)">戻る</button>
    </div>

    <!-- 画面5：充電器類 -->
    <div class="screen" id="screen5">
      <h1>充電器類</h1>
      <p>複数選択できます</p>
      <div class="select-area" id="chargerArea"></div>
      <p>登録番号を入力し、借りるボタンを押してください</p>
      <input type="number" id="regNumber5" placeholder="登録番号" />
      <button onclick="borrowCharger()">借りる</button>
      <button class="back" onclick="showScreen(1)">戻る</button>
    </div>

    <!-- 画面6：返却確認 -->
    <div class="screen" id="screen6">
      <h1>返却確認</h1>
      <table>
        <thead>
          <tr>
            <th>日時</th>
            <th>借りたもの</th>
            <th>登録番号</th>
            <th>返却確認</th>
          </tr>
        </thead>
        <tbody id="history"></tbody>
      </table>
      <button class="back" onclick="showScreen(1)">戻る</button>
    </div>

    <script>
      let data = JSON.parse(localStorage.getItem("lendData") || "[]");
      let selected = { type: "", items: [] };

      function showScreen(n) {
        document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
        document.getElementById("screen" + n).classList.add("active");
        if (n === 6) drawHistory();
      }

      function selectItem(type) {
        selected = { type, items: [] };
        if (type === "卓球ラケット") {
          createRackets();
          showScreen(2);
        } else if (type === "コントローラー") {
          createControllers();
          showScreen(3);
        } else if (type === "ボドゲ・その他") {
          showScreen(4);
        } else if (type === "充電器類") {
          createChargers();
          showScreen(5);
        }
      }

      function createRackets() {
        const area = document.getElementById("racketArea");
        area.innerHTML = "";
        [1,2,3,4].forEach(n => {
          const inUse = data.some(d => d.type==="卓球ラケット" && d.item==n && d.checker==="");
          const b = document.createElement("button");
          b.textContent = n;
          if (inUse) b.classList.add("disabled");
          else b.onclick = () => {
            if (selected.items.includes(n)) {
              selected.items = selected.items.filter(x=>x!==n);
              b.classList.remove("selected");
            } else {
              selected.items.push(n);
              b.classList.add("selected");
            }
          };
          area.appendChild(b);
        });
      }

      function createControllers() {
        const area = document.getElementById("controllerArea");
        area.innerHTML = "";
        [1,2,3,4,5,6,7,8,"ジョイコン"].forEach(n=>{
          const inUse = data.some(d=>d.type==="コントローラー" && d.item==n && d.checker==="");
          const b = document.createElement("button");
          b.textContent = n;
          if (inUse) b.classList.add("disabled");
          else b.onclick = () => {
            area.querySelectorAll("button").forEach(btn=>btn.classList.remove("selected"));
            b.classList.add("selected");
            selected.items = [n];
          };
          area.appendChild(b);
        });
      }

      function createChargers() {
        const area = document.getElementById("chargerArea");
        area.innerHTML = "";
        const types = [
          {name:"延長コード", count:9},
          {name:"充電器", count:10},
          {name:"充電コード", count:12}
        ];
        types.forEach(t=>{
          for(let i=1;i<=t.count;i++){
            const itemName = `${t.name}${i}`;
            const inUse = data.some(d=>d.type==="充電器類" && d.item===itemName && d.checker==="");
            const b = document.createElement("button");
            b.textContent = itemName;
            if (inUse) b.classList.add("disabled");
            else b.onclick = () => {
              if (selected.items.includes(itemName)) {
                selected.items = selected.items.filter(x=>x!==itemName);
                b.classList.remove("selected");
              } else {
                selected.items.push(itemName);
                b.classList.add("selected");
              }
            };
            area.appendChild(b);
          }
        });
      }

      function borrow() {
        const active = document.querySelector(".screen.active");
        const input = active.querySelector("input[type='number']");
        const num = input.value;
        if(!num || selected.items.length===0) return;
        selected.items.forEach(item=>{
          const inUse = data.some(d=>d.type===selected.type && d.item==item && d.checker==="");
          if(inUse) return alert("貸出中です");
          data.push({type:selected.type, item, number:num, date:new Date().toLocaleString(), checker:""});
        });
        localStorage.setItem("lendData", JSON.stringify(data));
        showScreen(1);
      }

      function borrowGame() {
        const name = document.getElementById("gameInput").value;
        const num = document.getElementById("regNumber4").value;
        if(!name || !num) return;
        const inUse = data.some(d=>d.type==="ボドゲ・その他" && d.item===name && d.checker==="");
        if(inUse) return alert("貸出中です");
        data.push({type:"ボドゲ・その他", item:name, number:num, date:new Date().toLocaleString(), checker:""});
        localStorage.setItem("lendData", JSON.stringify(data));
        showScreen(1);
      }

      function borrowCharger() {
        const num = document.getElementById("regNumber5").value;
        if(!num || selected.items.length===0) return;
        selected.items.forEach(item=>{
          data.push({type:"充電器類", item, number:num, date:new Date().toLocaleString(), checker:""});
        });
        localStorage.setItem("lendData", JSON.stringify(data));
        showScreen(1);
      }

      function drawHistory() {
        const body = document.getElementById("history");
        body.innerHTML = "";
        data.forEach((d,i)=>{
          const tr = document.createElement("tr");
          tr.innerHTML = `
            <td>${d.date}</td>
            <td>${d.type}${d.item}</td>
            <td>${d.number}</td>
            <td>
              <select id="checker-${i}">
                <option value=""></option>
                <option value="確認">確認</option>
              </select>
            </td>`;
          body.appendChild(tr);

          const select = document.getElementById(`checker-${i}`);
          select.value = d.checker;
          select.addEventListener("change", ()=>{
            data[i].checker = select.value;
            localStorage.setItem("lendData", JSON.stringify(data));
          });
        });
      }
    </script>
  </body>
</html>
